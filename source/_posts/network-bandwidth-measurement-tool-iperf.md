---
title: ç½‘ç»œå¸¦å®½æµ‹è¯•å·¥å…·â€”â€”iperf
date: 2021-12-19 15:45:55
tags: network
categories: network
---

æœ¬æ–‡ä»‹ç»äº†ç½‘ç»œå¸¦å®½æµ‹è¯•å·¥å…·iperfçš„å®‰è£…å’Œä½¿ç”¨ã€‚

<!--more-->

iperfæ˜¯ä¸€ä¸ªç½‘ç»œå¸¦å®½æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥ç”¨äºæµ‹è¯•TCPã€UDPä»¥åŠSCTPçš„ç½‘ç»œå¸¦å®½ã€‚

### å®‰è£…iperf3

#### ä½¿ç”¨åŒ…ç®¡ç†å™¨

```shell
# Ubuntu
apt install -y iperf3

# CentOS
yum install -y iperf3
```

åŒ…ç®¡ç†å™¨çš„ä¼˜ç‚¹åœ¨äºå®‰è£…ç®€å•ï¼Œä½†è½¯ä»¶åŒ…çš„ç‰ˆæœ¬é€šå¸¸ä¸æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ã€‚

#### æºç å®‰è£…

ä¸‹é¢ğŸ‘‡ä½¿ç”¨æºç å®‰è£…iperf3ï¼š

1.ä¸‹è½½iperf3

ä»[å®˜ç½‘](https://downloads.es.net/pub/iperf/)ä¸­é€‰æ‹©éœ€è¦çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œä»¥`v3.10.1`ä¸ºä¾‹ï¼š

```shell
wget https://downloads.es.net/pub/iperf/iperf-3.10.1.tar.gz
```

2.è§£å‹ç¼©

```shell
tar -zxf iperf-3.10.1.tar.gz
```

3.è¿›å…¥æºç ç›®å½•

```shell
cd iperf-3.10.1
```

4.æ‰§è¡Œé…ç½®ç¨‹åº

```shell
./configure
```

è‹¥å‡ºç°å¦‚ä¸‹çš„é”™è¯¯ï¼š

```shell
configure: error: no acceptable C compiler found in $PATH
```

åˆ™è¡¨æ˜æ²¡æœ‰å®‰è£…Cè¯­è¨€ç¼–è¯‘å™¨ã€‚æ­¤æ—¶ï¼Œéœ€è¦å®‰è£…ä»»æ„ä¸€ç§Cè¯­è¨€ç¼–è¯‘å™¨ï¼Œå¦‚GCCï¼š

```shell
yum install -y gcc
```

5.ç¼–è¯‘

```shell
make -j5
```

6.å®‰è£…

```shell
make install
```

7.æŸ¥çœ‹ç‰ˆæœ¬

```shell
# iperf3 --version
iperf3 -v
```

![æŸ¥çœ‹ç‰ˆæœ¬](/static/images/iperf-version.png)

### æµ‹è¯•ç½‘ç»œå¸¦å®½

åœ¨ä½¿ç”¨iperf3æ‰§è¡Œç½‘ç»œå¸¦å®½æµ‹è¯•å‰ï¼Œéœ€è¦ç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½å·²ç»å®‰è£…äº†iperf3ã€‚

1.å¯åŠ¨æœåŠ¡å™¨ç«¯

```shell
# åœ¨å‰å°è¿è¡Œ
iperf3 --server
iperf3 -s
```

![å¯åŠ¨æœåŠ¡å™¨ç«¯](/static/images/iperf-server.png)

é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ç«¯ä¼šåœ¨å‰å°æ‰§è¡Œã€‚å¯ä»¥ä½¿ç”¨`-D`æˆ–`--daemon`è®©æœåŠ¡å™¨ç«¯åœ¨åå°è¿è¡Œï¼š

```shell
iperf3 -s -D
```

é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ç«¯ç›‘å¬çš„æ˜¯TCPçš„5201ç«¯å£ã€‚å¯ä»¥ä½¿ç”¨`-p`æ‰‹åŠ¨è®¾ç½®ç›‘å¬ç«¯å£ï¼š

```shell
iperf3 -s -D -p 5002
```

2.å¯åŠ¨å®¢æˆ·ç«¯

```shell
iperf3 -c <host>
```

å…¶ä¸­ï¼Œ`<host>`è¡¨ç¤ºæœåŠ¡å™¨ç«¯çš„åœ°å€

ä¸‹é¢ä½¿ç”¨æœ¬æœºä½œä¸ºæœåŠ¡å™¨ç«¯ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯åœ¨ä¸€å°æœºå™¨ä¸Šï¼‰ï¼š

![å¯åŠ¨å®¢æˆ·ç«¯](/static/images/iperf-client.png)

å…¶ä¸­ï¼ŒRetrè¡¨ç¤º`Retransmission`ï¼ŒCwndè¡¨ç¤º`Congestion Window`ï¼ˆæ‹¥å¡çª—å£ï¼‰ã€‚

è‹¥å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š

```shell
iperf3: error - unable to connect to server: No route to host
```

åˆ™éœ€è¦å…³é—­æœåŠ¡å™¨ç«¯çš„é˜²ç«å¢™ï¼š

```shell
systemctl stop firewalld
```

* æµ‹è¯•æŒç»­æ—¶é—´

é»˜è®¤æƒ…å†µä¸‹ï¼Œåªä¼šè¿è¡Œ10ç§’ã€‚å¯ä»¥ä½¿ç”¨`-t`è®¾ç½®æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ï¼š

```shell
# æŒç»­60ç§’
iperf3 -c <host> -t 60
```

* æŒ‡å®šè¿æ¥ç«¯å£

å¦‚æœæœåŠ¡å™¨ç«¯ç›‘å¬çš„ä¸æ˜¯é»˜è®¤ç«¯å£ï¼Œåˆ™å®¢æˆ·ç«¯å¿…é¡»æŒ‡å®šè¿æ¥ç«¯å£ï¼š

```shell
iperf3 -c <host> -p 5002
```

* æŒ‡å®šæ—¥å¿—æ–‡ä»¶ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œç»Ÿè®¡ç»“æœç›´æ¥è¾“å‡ºåœ¨ç»ˆç«¯ä¸­ã€‚å¯ä»¥ä½¿ç”¨`--logfile`æŒ‡å®šå­˜å‚¨è¾“å‡ºç»“æœçš„æ—¥å¿—æ–‡ä»¶ã€‚

```shell
iperf3 -c <host> -t 60 --logfile result.txt
```

* æŒ‡å®šè¾“å‡ºçš„å•ä½ï¼š`-f `æˆ–è€…`--format [kmgtKMGT]`

```shell
# å¤§å†™å­—æ¯è¡¨ç¤ºä½¿ç”¨å­—èŠ‚ä¸ºå•ä½è¾“å‡ºç»“æœï¼Œå°å†™å­—æ¯è¡¨ç¤ºä½¿ç”¨æ¯”ç‰¹ä¸ºå•ä½ï¼Œå¦‚Gè¡¨ç¤ºGBytesï¼Œgè¡¨ç¤ºGbits
iperf3 -c <host> -t 60 -f G --logfile result.txt
```

* æŒ‡å®šå…¶ä»–æ•°æ®ä¼ è¾“æ¨¡å¼ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®ä¼ è¾“é‡‡ç”¨æ™®é€šæ¨¡å¼ï¼Œå³ä»å®¢æˆ·ç«¯ä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚

ä½¿ç”¨`-R`æˆ–è€…`--reverse`æŒ‡å®šä»¥åå‘æ¨¡å¼è¿è¡Œï¼Œå³ä»æœåŠ¡å™¨ç«¯ä¸‹è½½åˆ°å®¢æˆ·ç«¯ï¼›

ä½¿ç”¨`--bidir`æŒ‡å®šä»¥åŒå‘æ¨¡å¼è¿è¡Œï¼Œå³ä»å®¢æˆ·ç«¯ä¸Šä¼ æ•°æ®åˆ°æœåŠ¡å™¨ç«¯ï¼ŒåŒæ—¶ä»æœåŠ¡å™¨ç«¯ä¸‹è½½æ•°æ®åˆ°å®¢æˆ·ç«¯ã€‚

åœ¨è¾“å‡ºç»“æœçš„Roleåˆ—ä¸­ï¼ŒRXè¡¨ç¤ºReceiveï¼ŒTXè¡¨ç¤ºTransmitï¼Œ-Cè¡¨ç¤ºClientï¼Œ-Sè¡¨ç¤ºServerã€‚

```shell
iperf3 -c <host> -t 60 -f G --bidir --logfile result.txt
```

* è¾“å‡ºJSONæ ¼å¼

```shell
iperf3 -c <host> -t 60 -J > result.json
```

### å‚è€ƒèµ„æ–™

1.iperf3ä¸»é¡µï¼šhttps://software.es.net/iperf/

2.æºç ä»“åº“ï¼šhttps://github.com/esnet/iperf

3.http://ce.sc.edu/cyberinfra/workshops/Material/NTP/Lab%202.pdf

4.what "Retr" field meanï¼Œhttps://github.com/esnet/iperf/issues/343
